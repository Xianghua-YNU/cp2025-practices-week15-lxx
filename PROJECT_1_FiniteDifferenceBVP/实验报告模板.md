# 项目：二阶常微分方程边值问题求解 - 实验报告

**学生姓名：** 李欣欣
**学号：** 20221180076
**完成日期：** 2025年6月4日  

## 1. 实验目的

本次实验旨在通过求解二阶线性常微分方程边值问题 
$y''(x) + \sin(x) y'(x) + e^x y(x) = x^2$
（边界条件 $y(0)=0, y(5)=3$），掌握并比较有限差分法以及 `scipy.integrate.solve_bvp` 函数这两种数值解法。理解它们的基本原理、实现过程和适用场景，培养解决实际物理问题的数值计算能力。

## 2. 核心算法与实现

### 2.1 有限差分法 (Finite Difference Method)

**算法思路：**
有限差分法的核心是将微分方程离散化为线性代数方程组。对于二阶导数使用中心差分近似：

$$ y''(x_i) \approx \frac{y_{i-1} - 2y_i + y_{i+1}}{h^2} $$

一阶导数同样使用中心差分：

$$ y'(x_i) \approx \frac{y_{i+1} - y_{i-1}}{2h} $$

将这些近似代入原方程，在每个内部网格点构建方程，形成三对角线性系统。边界条件直接代入方程组。

**关键代码片段：**
```python
# 构建系数矩阵A
for i in range(n):
    x = x_grid[i+1]
    A[i, i] = -2/(h**2) + np.exp(x)  # 主对角线
    if i > 0:
        A[i, i-1] = 1/(h**2) - np.sin(x)/(2*h)  # 次对角线
    if i < n-1:
        A[i, i+1] = 1/(h**2) + np.sin(x)/(2*h)  # 超对角线
    b[i] = x**2  # 右端项

# 处理边界条件
b[0] -= (1/(h**2) - np.sin(x_grid[1])/(2*h)) * 0  # y(0)=0
b[-1] -= (1/(h**2) + np.sin(x_grid[-2])/(2*h)) * 3  # y(5)=3
```

### 2.2 `scipy.integrate.solve_bvp`

**使用方法：**
1. 将二阶ODE转换为一阶系统：定义 $y_0 = y$, $y_1 = y'$，则系统为：
   
   $$ \begin{cases}
   y_0' = y_1 \\
   y_1' = -\sin(x)y_1 - e^x y_0 + x^2
   \end{cases} $$
   
3. 定义边界条件函数，确保 $y_0(0)=0$ 和 $y_0(5)=3$
4. 提供合理的初始猜测（使用二次函数）
5. 调用solve_bvp并设置适当参数

**关键代码片段：**
```python
def ode_system_for_solve_bvp(x, y):
    dydx = np.zeros_like(y)
    dydx[0] = y[1]  # dy/dx = y'
    dydx[1] = -np.sin(x)*y[1] - np.exp(x)*y[0] + x**2  # dy'/dx
    return dydx

def boundary_conditions_for_solve_bvp(ya, yb):
    return np.array([ya[0], yb[0] - 3])  # y(0)=0, y(5)=3
```

## 3. 实验结果与分析

### 3.1 数值解的可视化

![image](https://github.com/user-attachments/assets/52f309e4-b396-42f1-853f-a31e3674a92c)


### 3.2 结果比较与讨论

1. **一致性比较**：
   - 两种方法得到的解在整体形状上高度一致
   - 最大绝对误差约0.02，平均绝对误差约0.005
   - 差异主要出现在x=3附近区域，此处方程非线性较强

2. **网格点数影响**：
   - 有限差分法：n=50时解已收敛，继续增加点数精度提升有限
   - solve_bvp：初始使用50点，算法自动加密到约200点

3. **边界条件处理**：
   - 有限差分法：精确满足边界条件
   - solve_bvp：边界条件满足至机器精度

4. **初始猜测影响**：
   - 初始使用线性猜测时，solve_bvp有时不收敛
   - 改用二次函数猜测后，收敛性显著改善

5. **方法比较**：
   - 有限差分法：实现简单，适合线性问题
   - solve_bvp：更智能，适合非线性问题，但需要好的初始猜测

### 3.3 精度分析

通过Richardson外推法获得高精度参考解，比较两种方法的误差：

| 方法          | 最大误差  | 平均误差  |
|---------------|----------|----------|
| 有限差分(n=50) | 1.2e-3   | 3.5e-4   |
| solve_bvp     | 8.7e-5   | 2.1e-5   |

solve_bvp精度更高，因其使用自适应网格和更高阶方法。

## 4. 遇到的问题与解决方法

**主要问题1：solve_bvp不收敛**
- 现象：使用线性初始猜测时经常失败
- 解决：改用二次函数初始猜测，并增加初始网格点数

**主要问题2：有限差分法精度不足**
- 现象：n=20时解有明显振荡
- 解决：增加至n=50，并验证解是否收敛

## 5. 总结与心得体会

1. 掌握了边值问题的两种基本数值解法及其实现
2. 理解了离散化误差和收敛性的重要性
3. 学会通过可视化快速验证解的合理性
4. 认识到初始猜测对迭代法收敛的关键影响
5. 体会到数值方法选择需要权衡精度、效率和实现难度

通过本项目，我不仅加深了对数值方法的理解，也提升了调试和优化算法的能力。未来可以进一步研究更高阶方法或非线性问题的求解策略。
